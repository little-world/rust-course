<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rust Patterns - Master Rust Through Practical Patterns</title>
  <meta name="description" content="A comprehensive guide to Rust programming patterns covering memory ownership, concurrency, async programming, and more.">
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<header class="hero">
  <nav class="nav">
    <div class="nav-brand">Rust Patterns</div>
    <div class="nav-links">
      <a href="#chapters">Chapters</a>
      <a href="#workbook">Workbook</a>
      <a href="#pricing">Pricing</a>
      <a href="#pricing" class="btn btn-primary">Get the Book</a>
    </div>
  </nav>
  <div class="hero-content">
    <div class="hero-badge">Comprehensive Rust Guide</div>
    <h1>Rust Patterns</h1>
    <p class="hero-subtitle">Master Rust through 33 essential pattern chapters and 87 hands-on projects</p>
    <div class="hero-cta">
      <a href="#pricing" class="btn btn-large btn-primary">
        Get the Book
      </a>
      <a href="#chapters" class="btn btn-large btn-secondary">
        Explore Contents
      </a>
    </div>
    <div class="hero-stats">
      <div class="stat">
        <span class="stat-number">33</span>
        <span class="stat-label">Chapters</span>
      </div>
      <div class="stat">
        <span class="stat-number">87</span>
        <span class="stat-label">Projects</span>
      </div>
      <div class="stat">
        <span class="stat-number">100%</span>
        <span class="stat-label">Practical</span>
      </div>
    </div>
  </div>
</header>

<main>
  <section id="chapters" class="section">
    <div class="container">
      <h2 class="section-title">Book Chapters</h2>
      <p class="section-subtitle">From fundamentals to advanced patterns, each chapter builds your Rust expertise</p>

      <div class="chapters-grid">
        <div class="chapter-category">
          <h3 class="category-title">Core Patterns</h3>
          <ul class="chapter-list">
            <li><span class="chapter-num">1</span> Memory & Ownership Patterns</li>
            <li><span class="chapter-num">2</span> Struct & Enum Patterns</li>
            <li><span class="chapter-num">3</span> Trait Design Patterns</li>
            <li><span class="chapter-num">4</span> Generics & Polymorphism</li>
            <li><span class="chapter-num">5</span> Builder & API Design</li>
            <li><span class="chapter-num">6</span> Lifetime Patterns</li>
          </ul>
        </div>

        <div class="chapter-category">
          <h3 class="category-title">Functional & Matching</h3>
          <ul class="chapter-list">
            <li><span class="chapter-num">7</span> Functional Programming</li>
            <li><span class="chapter-num">8</span> Pattern Matching & Destructuring</li>
            <li><span class="chapter-num">9</span> Iterator Patterns & Combinators</li>
            <li><span class="chapter-num">10</span> Reference Binding</li>
            <li><span class="chapter-num">11</span> Error Handling Architecture</li>
          </ul>
        </div>

        <div class="chapter-category">
          <h3 class="category-title">Data Structures</h3>
          <ul class="chapter-list">
            <li><span class="chapter-num">12</span> Vec & Slice Manipulation</li>
            <li><span class="chapter-num">13</span> String Processing</li>
            <li><span class="chapter-num">14</span> HashMap & HashSet Patterns</li>
            <li><span class="chapter-num">15</span> Advanced Collections</li>
          </ul>
        </div>

        <div class="chapter-category">
          <h3 class="category-title">Concurrency</h3>
          <ul class="chapter-list">
            <li><span class="chapter-num">16</span> Threading Patterns</li>
            <li><span class="chapter-num">17</span> Async Runtime Patterns</li>
            <li><span class="chapter-num">18</span> Atomic Operations & Lock-Free</li>
            <li><span class="chapter-num">19</span> Parallel Algorithms</li>
          </ul>
        </div>

        <div class="chapter-category">
          <h3 class="category-title">Advanced Memory</h3>
          <ul class="chapter-list">
            <li><span class="chapter-num">20</span> Smart Pointer Patterns</li>
            <li><span class="chapter-num">21</span> Unsafe Rust Patterns</li>
          </ul>
        </div>

        <div class="chapter-category">
          <h3 class="category-title">I/O & Serialization</h3>
          <ul class="chapter-list">
            <li><span class="chapter-num">22</span> Synchronous I/O</li>
            <li><span class="chapter-num">23</span> Async I/O Patterns</li>
            <li><span class="chapter-num">24</span> Serialization Patterns</li>
          </ul>
        </div>

        <div class="chapter-category">
          <h3 class="category-title">Metaprogramming</h3>
          <ul class="chapter-list">
            <li><span class="chapter-num">25</span> Declarative Macros</li>
            <li><span class="chapter-num">26</span> Procedural Macros</li>
            <li><span class="chapter-num">27</span> FFI and C Interop</li>
          </ul>
        </div>

        <div class="chapter-category">
          <h3 class="category-title">Real-World Systems</h3>
          <ul class="chapter-list">
            <li><span class="chapter-num">28</span> Network Programming</li>
            <li><span class="chapter-num">29</span> Database Patterns</li>
            <li><span class="chapter-num">30</span> Testing and Benchmarking</li>
          </ul>
        </div>

        <div class="chapter-category">
          <h3 class="category-title">Appendices</h3>
          <ul class="chapter-list">
            <li><span class="chapter-num">31</span> Appendix A: Quick Reference</li>
            <li><span class="chapter-num">32</span> Appendix B: Design Patterns</li>
            <li><span class="chapter-num">33</span> Appendix C: Anti Patterns</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <section id="workbook" class="section section-alt">
    <div class="container">
      <h2 class="section-title">Companion Workbook</h2>
      <p class="section-subtitle">87 hands-on projects to cement your understanding through practice</p>

      <div class="workbook-filter">
        <button class="filter-btn active" data-filter="all">All Projects</button>
        <button class="filter-btn" data-filter="memory">Memory</button>
        <button class="filter-btn" data-filter="data">Data Structures</button>
        <button class="filter-btn" data-filter="concurrency">Concurrency</button>
        <button class="filter-btn" data-filter="network">Network</button>
        <button class="filter-btn" data-filter="systems">Systems</button>
      </div>

      <div class="workbook-grid">
        <!-- Memory & Ownership Projects -->
        <div class="project-card" data-category="memory">
          <span class="project-num">1</span>
          <h4>lru-cache</h4>
          <p>Implement an LRU cache that keeps recently accessed items and evicts the least-used entry when the capacity limit is reached.</p>
        </div>

        <div class="project-card" data-category="memory">
          <span class="project-num">2</span>
          <h4>expression-parser-arena</h4>
          <p>Build an arithmetic-expression parser that uses arena (bump) allocation so parsed trees share storage.</p>
        </div>

        <div class="project-card" data-category="memory">
          <span class="project-num">3</span>
          <h4>string-interning</h4>
          <p>Create a string interning system that stores each unique string once and hands out reusable references.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">4</span>
          <h4>generic-data-structures</h4>
          <p>Assemble a const-generic collection toolkit whose sizes live in the type system and incur zero runtime cost.</p>
        </div>

        <div class="project-card" data-category="memory">
          <span class="project-num">5</span>
          <h4>memory-pool</h4>
          <p>Write a pool allocator that pre-allocates a big block and serves fixed-size slots quickly to hot code paths.</p>
        </div>

        <div class="project-card" data-category="memory">
          <span class="project-num">6</span>
          <h4>reference-count</h4>
          <p>Re-implement reference counting to learn how Rc/Arc-like structures manage shared ownership.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">7</span>
          <h4>safe-configuration</h4>
          <p>Define configuration newtypes and builders that prevent invalid server configs at compile time.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">8</span>
          <h4>streaming-iterator-hrtb</h4>
          <p>Implement a streaming iterator that yields borrowed data via higher-ranked trait bounds and GATs.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">9</span>
          <h4>validated-wrappers</h4>
          <p>Implement validated wrapper types (Email, Url, NonEmptyString, PositiveInt) for type-safe domain modeling.</p>
        </div>

        <div class="project-card" data-category="memory">
          <span class="project-num">10</span>
          <h4>zero-copy-protocol</h4>
          <p>Parse text by borrowing slices from the input so tokens remain valid without allocations.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">11</span>
          <h4>parser-combinator</h4>
          <p>Build a functional parser combinator library with composable parsing primitives.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">12</span>
          <h4>middleware-pipeline</h4>
          <p>Create a functional middleware pipeline for request/response processing.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">13</span>
          <h4>json-parser-validator</h4>
          <p>Parse JSON into an AST and validate against schemas using pattern matching.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">14</span>
          <h4>network-packet-inspector</h4>
          <p>Inspect multi-layer network packets, enforce firewall rules, and detect malicious patterns.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">15</span>
          <h4>order-state-machine</h4>
          <p>Model an order workflow with enums so illegal state transitions can't compile.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">16</span>
          <h4>regex-engine</h4>
          <p>Build a regex engine that parses patterns, supports captures/alternation, and backtracks correctly.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">17</span>
          <h4>csv-parser</h4>
          <p>Stream massive CSV files using iterators that handle quoting and keep memory usage flat.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">18</span>
          <h4>pagination-iterator</h4>
          <p>Expose paginated REST endpoints as lazy iterators that fetch pages on demand.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">19</span>
          <h4>plugins</h4>
          <p>Load runtime-selected plugins safely so user code can extend the host app.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">20</span>
          <h4>config-validator</h4>
          <p>Parse TOML/JSON configs and emit precise schema errors for bad inputs.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">21</span>
          <h4>parser-combinator-traits</h4>
          <p>Build parser combinators with associated types so small parsers compose ergonomically.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">22</span>
          <h4>web-scraper-retry-breaker</h4>
          <p>Crawl many URLs concurrently with retries, rate limits, and circuit breakers.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">23</span>
          <h4>generics-queue</h4>
          <p>Implement a generic priority queue that accepts any Ord payload.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">24</span>
          <h4>csv-processor</h4>
          <p>Process multi-gig CSVs by chunking, transforming, validating, and batching inserts efficiently.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">25</span>
          <h4>timeseries</h4>
          <p>Analyze time-series streams by computing sliding-window statistics in O(n).</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">26</span>
          <h4>binary-search</h4>
          <p>Provide binary-search helpers that power fast queries over sorted data.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">27</span>
          <h4>log-parser</h4>
          <p>Parse huge log files into structured events with zero-copy string handling.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">28</span>
          <h4>text-editor-gap-buffer</h4>
          <p>Implement a gap-buffer editor core that makes insert/delete near the cursor cheap.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">29</span>
          <h4>boyer-moore-search</h4>
          <p>Apply Boyer-Moore substring search to find patterns efficiently in large texts.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">30</span>
          <h4>analytics-engine</h4>
          <p>Maintain real-time analytics over streaming events with HashMaps for aggregations.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">31</span>
          <h4>custom-hash-functions</h4>
          <p>Create custom hashers for spatial/geographic data to keep maps performant and correct.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">32</span>
          <h4>cache-alternative-maps</h4>
          <p>Compare alternative map types to build a multi-tier cache with varied access patterns.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">33</span>
          <h4>autocomplete</h4>
          <p>Build a trie-based autocomplete engine that returns suggestions fast.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">34</span>
          <h4>queue-crossbeam</h4>
          <p>Use crossbeam to implement a lock-free MPMC queue for parallel workloads.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">35</span>
          <h4>scheduling</h4>
          <p>Prioritize and schedule jobs via binary heaps that respect deadlines.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">36</span>
          <h4>image-processor</h4>
          <p>Fan out CPU-heavy image filters onto a thread pool for throughput.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">37</span>
          <h4>producer-consumer</h4>
          <p>Chain processing stages via channels to demonstrate producer/consumer backpressure.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">38</span>
          <h4>shared-counter</h4>
          <p>Coordinate shared counters across threads using Arc + Mutex.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">39</span>
          <h4>webscraper</h4>
          <p>Scrape the web asynchronously while respecting rate limits and handling failures.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">40</span>
          <h4>event-stream</h4>
          <p>Consume multiple event streams, transform them, and fan results out in real time.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">41</span>
          <h4>task-scheduler</h4>
          <p>Manage async tasks with priorities, deadlines, and retry policies.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">42</span>
          <h4>image-processing-async</h4>
          <p>Build an async pipeline that watches directories and processes images concurrently.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">43</span>
          <h4>metrics</h4>
          <p>Record metrics from many threads using lock-free atomics instead of mutexes.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">44</span>
          <h4>treiber-stack</h4>
          <p>Implement a lock-free Treiber stack using CAS loops and hazard pointers.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">45</span>
          <h4>ring-buffer</h4>
          <p>Implement a wait-free ring buffer for producer/consumer communication.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">46</span>
          <h4>sorting</h4>
          <p>Build a fork-join parallel sorting library that scales across cores.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">47</span>
          <h4>graph</h4>
          <p>Traverse graphs in parallel while balancing irregular workloads.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">48</span>
          <h4>map-reduce</h4>
          <p>Implement a mini MapReduce engine that distributes log analysis jobs.</p>
        </div>

        <div class="project-card" data-category="concurrency">
          <span class="project-num">49</span>
          <h4>kafka</h4>
          <p>Simulate a Kafka-style event pipeline that handles millions of messages per second.</p>
        </div>

        <div class="project-card" data-category="data">
          <span class="project-num">50</span>
          <h4>tokenizer</h4>
          <p>Build character-, word-, and BPE-tokenizers for ML pipelines.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">51</span>
          <h4>matrix-multiplication</h4>
          <p>Optimize matrix multiplication from naive O(n^3) up to tiled/SIMD/GPU variants.</p>
        </div>

        <div class="project-card" data-category="memory">
          <span class="project-num">52</span>
          <h4>rc-dom</h4>
          <p>Model a DOM tree with Rc/Weak so nodes share ownership and can navigate parents.</p>
        </div>

        <div class="project-card" data-category="memory">
          <span class="project-num">53</span>
          <h4>object-pool</h4>
          <p>Reuse expensive objects via a smart-pointer-backed pool instead of reallocating.</p>
        </div>

        <div class="project-card" data-category="memory">
          <span class="project-num">54</span>
          <h4>cow</h4>
          <p>Design copy-on-write structures that share data until a write occurs.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">55</span>
          <h4>cpu-optimization-convolution</h4>
          <p>Optimize 2D convolutions with cache blocking, SIMD, and threading.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">56</span>
          <h4>build-system-pipeline</h4>
          <p>Orchestrate compiler stages, capture logs, and re-run only changed targets.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">57</span>
          <h4>file-sync-rsync</h4>
          <p>Synchronize directories rsync-style by hashing chunks and copying only deltas.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">58</span>
          <h4>version-control-git</h4>
          <p>Implement Git primitives (blobs, trees, commits, refs) to track history and sync repos.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">59</span>
          <h4>async-http-proxy</h4>
          <p>Build an async HTTP proxy with connection pooling, backpressure, timeouts, and health checks.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">60</span>
          <h4>chat-server-broadcast</h4>
          <p>Broadcast chat messages to many clients while handling backpressure and disconnects.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">61</span>
          <h4>ini</h4>
          <p>Parse and emit INI files with serde-friendly structures and validation.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">62</span>
          <h4>performance</h4>
          <p>Benchmark JSON, Bincode, and MessagePack to compare size vs speed.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">63</span>
          <h4>migration</h4>
          <p>Migrate old serialized config formats to the latest schema transparently.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">64</span>
          <h4>query-builder</h4>
          <p>Generate SQL query builders with declarative macros for a type-safe DSL.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">65</span>
          <h4>test-framework</h4>
          <p>Build a macro-driven test harness that expands compact specs into full suites.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">66</span>
          <h4>config-dsl</h4>
          <p>Create a declarative config DSL macro that produces typed structs at compile time.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">67</span>
          <h4>orchestration</h4>
          <p>Use procedural macros to define deployment/orchestration manifests in Rust.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">68</span>
          <h4>spring-framework-macros</h4>
          <p>Mimic Spring Boot annotations with procedural macros for DI and routing.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">69</span>
          <h4>ffi-c</h4>
          <p>Wrap C's qsort/bsearch in safe Rust so arbitrary types can interop.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">70</span>
          <h4>ffi-python</h4>
          <p>Expose a Rust text-processing library as a Python module via PyO3.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">71</span>
          <h4>rust-assembly-optimization</h4>
          <p>Study Rust's assembly output and inject inline asm to tighten hotspots.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">72</span>
          <h4>chat-server</h4>
          <p>Grow a simple echo server into a full chat service with multiple protocols.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">73</span>
          <h4>udp-game-server</h4>
          <p>Build a UDP-based multiplayer server with service discovery and reliability.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">74</span>
          <h4>distributed-kv-store</h4>
          <p>Create a distributed KV store with replication, persistence, and leader election.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">75</span>
          <h4>collaborative-editor</h4>
          <p>Sync shared documents via CRDT-like techniques for concurrent editing.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">76</span>
          <h4>task-queue</h4>
          <p>Persist a durable task queue where workers lease and process jobs safely.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">77</span>
          <h4>blog-api</h4>
          <p>Expose CRUD blog APIs backed by SQLx with compile-time query checking.</p>
        </div>

        <div class="project-card" data-category="network">
          <span class="project-num">78</span>
          <h4>multi-tenant-saas</h4>
          <p>Partition tenant data and enforce tenant-aware queries in a SaaS schema.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">79</span>
          <h4>coverage-analyzer</h4>
          <p>Instrument Rust code to report line/branch/function coverage from tests.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">80</span>
          <h4>mutation-testing</h4>
          <p>Flip AST nodes deliberately and ensure the test suite fails appropriately.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">81</span>
          <h4>property-test-generator</h4>
          <p>Auto-generate property tests using proptest based on function signatures.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">82</span>
          <h4>profiler</h4>
          <p>Profile Rust programs by sampling CPU time, memory allocations, and call stacks.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">83</span>
          <h4>data-pipeline</h4>
          <p>Build a streaming data pipeline tuned for cache locality and SIMD throughput.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">84</span>
          <h4>cache-structures</h4>
          <p>Compare cache-friendly data layouts to maximize CPU efficiency.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">85</span>
          <h4>embedded-hal-sensor-driver</h4>
          <p>Hardware Abstraction Layer using traits for embedded systems.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">86</span>
          <h4>embedded-realtime-logger</h4>
          <p>Zero-copy DMA transfers for ADC, UART, and SPI in embedded contexts.</p>
        </div>

        <div class="project-card" data-category="systems">
          <span class="project-num">87</span>
          <h4>embedded-interrupt-coordinator</h4>
          <p>Priority-based interrupt management for embedded Rust applications.</p>
        </div>
      </div>
    </div>
  </section>

  <section id="pricing" class="section">
    <div class="container">
      <h2 class="section-title">Choose Your Package</h2>
      <p class="section-subtitle">Select the package that fits your learning goals</p>

      <div class="pricing-grid">
        <!-- Book Only -->
        <div class="pricing-card">
          <h3 class="pricing-tier">Book Only</h3>
          <div class="pricing-price">
            <span class="price-amount">$29</span>
          </div>
          <ul class="pricing-features">
            <li>33 comprehensive chapters</li>
            <li>Memory & ownership patterns</li>
            <li>Concurrency patterns</li>
            <li>Async programming</li>
            <li>PDF & EPUB formats</li>
          </ul>
          <div class="payment-buttons">
            <div id="paypal-button-book" class="paypal-button-container"></div>
            <button class="pay-btn pay-btn-card" data-tier="book" data-price="29">
              <svg class="pay-icon" viewBox="0 0 24 24" fill="currentColor"><rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2" fill="none"/><line x1="2" y1="10" x2="22" y2="10" stroke="currentColor" stroke-width="2"/></svg>
              Credit Card
            </button>
            <button class="pay-btn pay-btn-ideal" data-tier="book" data-price="29">
              <svg class="pay-icon" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" fill="none"/></svg>
              iDEAL
            </button>
          </div>
        </div>

        <!-- Book + Workbook -->
        <div class="pricing-card pricing-card-featured">
          <div class="pricing-badge">Most Popular</div>
          <h3 class="pricing-tier">Book + Workbook</h3>
          <div class="pricing-price">
            <span class="price-amount">$49</span>
          </div>
          <ul class="pricing-features">
            <li>Everything in Book Only</li>
            <li>87 hands-on projects</li>
            <li>Step-by-step solutions</li>
            <li>Real-world examples</li>
            <li>Practice exercises</li>
          </ul>
          <div class="payment-buttons">
            <div id="paypal-button-workbook" class="paypal-button-container"></div>
            <button class="pay-btn pay-btn-card" data-tier="workbook" data-price="49">
              <svg class="pay-icon" viewBox="0 0 24 24" fill="currentColor"><rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2" fill="none"/><line x1="2" y1="10" x2="22" y2="10" stroke="currentColor" stroke-width="2"/></svg>
              Credit Card
            </button>
            <button class="pay-btn pay-btn-ideal" data-tier="workbook" data-price="49">
              <svg class="pay-icon" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" fill="none"/></svg>
              iDEAL
            </button>
          </div>
        </div>

        <!-- Complete Bundle -->
        <div class="pricing-card">
          <h3 class="pricing-tier">Complete Bundle</h3>
          <div class="pricing-price">
            <span class="price-amount">$79</span>
          </div>
          <ul class="pricing-features">
            <li>Everything in Book + Workbook</li>
            <li>Complete source code</li>
            <li>Lifetime updates</li>
            <li>Priority support</li>
            <li>Bonus: Quick reference card</li>
          </ul>
          <div class="payment-buttons">
            <div id="paypal-button-bundle" class="paypal-button-container"></div>
            <button class="pay-btn pay-btn-card" data-tier="bundle" data-price="79">
              <svg class="pay-icon" viewBox="0 0 24 24" fill="currentColor"><rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2" fill="none"/><line x1="2" y1="10" x2="22" y2="10" stroke="currentColor" stroke-width="2"/></svg>
              Credit Card
            </button>
            <button class="pay-btn pay-btn-ideal" data-tier="bundle" data-price="79">
              <svg class="pay-icon" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" fill="none"/></svg>
              iDEAL
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section cta-section">
    <div class="container">
      <h2>Ready to Master Rust Patterns?</h2>
      <p>Get the complete book with 33 chapters and 87 hands-on projects</p>
      <a href="#pricing" class="btn btn-large btn-primary">
        Choose Your Package
      </a>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-brand">
        <h3>Rust Patterns</h3>
        <p>Master Rust through practical patterns and real-world projects</p>
      </div>
      <div class="footer-links">
        <a href="https://leanpub.com/rust-patterns" target="_blank" rel="noopener">Leanpub</a>
        <a href="#chapters">Chapters</a>
        <a href="#workbook">Workbook</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 Rust Patterns. All rights reserved.</p>
    </div>
  </div>
</footer>

<!-- PayPal SDK - Will be loaded dynamically after getting client ID from backend -->
<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>

<script>
  // ============================================
  // BACKEND API CONFIGURATION
  // ============================================
  const API_BASE_URL = 'http://localhost:8081/api/payments';

  // ============================================
  // API HELPER FUNCTIONS
  // ============================================
  async function apiCall(endpoint, method = 'GET', body = null) {
    const options = {
      method,
      headers: { 'Content-Type': 'application/json' },
    };
    if (body) {
      options.body = JSON.stringify(body);
    }
    const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
    return response.json();
  }

  function showLoading(button) {
    button.disabled = true;
    button.dataset.originalText = button.textContent;
    button.textContent = 'Processing...';
  }

  function hideLoading(button) {
    button.disabled = false;
    if (button.dataset.originalText) {
      button.textContent = button.dataset.originalText;
    }
  }

  function showMessage(message, isError = false) {
    alert(message);
  }

  // ============================================
  // PAYPAL INTEGRATION (via Backend)
  // ============================================
  function initPayPalButtons() {
    const tiers = ['book', 'workbook', 'bundle'];

    tiers.forEach(tier => {
      const containerId = `paypal-button-${tier}`;
      const container = document.getElementById(containerId);

      if (container && typeof paypal !== 'undefined') {
        paypal.Buttons({
          style: {
            layout: 'horizontal',
            color: 'gold',
            shape: 'rect',
            label: 'paypal',
            height: 40
          },
          createOrder: async (data, actions) => {
            try {
              const response = await apiCall('/paypal/create', 'POST', { productId: tier });
              if (response.success && response.orderId) {
                return response.orderId;
              } else {
                throw new Error(response.message || 'Failed to create order');
              }
            } catch (error) {
              console.error('PayPal create order error:', error);
              showMessage('Failed to create PayPal order. Please try again.', true);
              throw error;
            }
          },
          onApprove: async (data, actions) => {
            try {
              const response = await apiCall('/paypal/capture', 'POST', { orderId: data.orderID });
              if (response.success) {
                showMessage('Payment successful! Thank you for your purchase. Check your email for download instructions.');
                // Optionally redirect to success page
                // window.location.href = '/success.html';
              } else {
                throw new Error(response.message || 'Payment capture failed');
              }
            } catch (error) {
              console.error('PayPal capture error:', error);
              showMessage('Payment verification failed. Please contact support.', true);
            }
          },
          onError: (err) => {
            console.error('PayPal error:', err);
            showMessage('Payment failed. Please try again or use a different payment method.', true);
          },
          onCancel: () => {
            console.log('Payment cancelled');
          }
        }).render(`#${containerId}`);
      }
    });
  }

  // ============================================
  // STRIPE INTEGRATION (via Backend)
  // ============================================
  async function initiateStripePayment(productId, paymentMethod) {
    try {
      const response = await apiCall('/stripe/checkout', 'POST', {
        productId: productId,
        paymentMethod: paymentMethod
      });

      if (response.success && response.checkoutUrl) {
        // Redirect to Stripe Checkout
        window.location.href = response.checkoutUrl;
      } else {
        throw new Error(response.message || 'Failed to create checkout session');
      }
    } catch (error) {
      console.error('Stripe checkout error:', error);
      showMessage('Failed to initiate payment. Please try again.', true);
    }
  }

  function initStripeButtons() {
    // Credit Card buttons
    document.querySelectorAll('.pay-btn-card').forEach(btn => {
      btn.addEventListener('click', async () => {
        const tier = btn.dataset.tier;
        showLoading(btn);
        try {
          await initiateStripePayment(tier, 'card');
        } finally {
          hideLoading(btn);
        }
      });
    });

    // iDEAL buttons
    document.querySelectorAll('.pay-btn-ideal').forEach(btn => {
      btn.addEventListener('click', async () => {
        const tier = btn.dataset.tier;
        showLoading(btn);
        try {
          await initiateStripePayment(tier, 'ideal');
        } finally {
          hideLoading(btn);
        }
      });
    });
  }

  // ============================================
  // HANDLE PAYMENT SUCCESS/CANCEL REDIRECTS
  // ============================================
  async function handlePaymentRedirect() {
    const hash = window.location.hash;
    const urlParams = new URLSearchParams(window.location.search);

    // Check for Stripe success
    if (urlParams.has('session_id') && urlParams.get('provider') === 'stripe') {
      const sessionId = urlParams.get('session_id');
      try {
        const response = await apiCall(`/stripe/verify?session_id=${sessionId}`);
        if (response.success) {
          showMessage('Payment successful! Thank you for your purchase. Check your email for download instructions.');
        }
      } catch (error) {
        console.error('Failed to verify Stripe payment:', error);
      }
      // Clean up URL
      window.history.replaceState({}, document.title, window.location.pathname + '#pricing');
    }

    // Check for PayPal success
    if (urlParams.get('provider') === 'paypal') {
      showMessage('Payment successful! Thank you for your purchase. Check your email for download instructions.');
      window.history.replaceState({}, document.title, window.location.pathname + '#pricing');
    }

    // Show success message if hash is #success
    if (hash === '#success') {
      showMessage('Payment successful! Thank you for your purchase.');
      window.history.replaceState({}, document.title, window.location.pathname + '#pricing');
    }
  }

  // ============================================
  // FILTER FUNCTIONALITY
  // ============================================
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const filter = btn.dataset.filter;

      // Update active button
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // Filter cards
      document.querySelectorAll('.project-card').forEach(card => {
        if (filter === 'all' || card.dataset.category === filter) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });
  });

  // ============================================
  // SMOOTH SCROLL
  // ============================================
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });

  // ============================================
  // INITIALIZE
  // ============================================
  document.addEventListener('DOMContentLoaded', () => {
    // Handle payment redirects
    handlePaymentRedirect();

    // Initialize PayPal buttons
    if (typeof paypal !== 'undefined') {
      initPayPalButtons();
    } else {
      console.warn('PayPal SDK not loaded. PayPal payments will not be available.');
      // Hide PayPal button containers
      document.querySelectorAll('.paypal-button-container').forEach(el => {
        el.innerHTML = '<p style="color: #888; font-size: 0.8rem;">PayPal unavailable</p>';
      });
    }

    // Initialize Stripe buttons
    initStripeButtons();

    // Check backend health
    apiCall('/health').then(response => {
      if (!response.success) {
        console.warn('Payment backend may not be running');
      }
    }).catch(() => {
      console.warn('Payment backend is not reachable at ' + API_BASE_URL);
    });
  });
</script>
</body>
</html>
